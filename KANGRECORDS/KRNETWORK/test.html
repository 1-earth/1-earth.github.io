<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Community Network Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="instructions">
        <h2>KR Community Network</h2>
        <strong>Instructions:</strong>
        <ul>
            <li>Hover over a node to preview details.</li>
            <li>Click a node to view connections.</li>
            <li>Use mouse scroll or drag to zoom and pan.</li>
        </ul>
    </div>

    <div class="controls-container">
        <button id="filter-button" onclick="toggleFilterMenu()">
            Filter by Practice
        </button>
        <div id="filter-menu" class="filter-menu">
            <div class="filter-checkbox">
                <input type="checkbox" id="3D" onchange="applyPracticeFilter()" /> 3D
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Architecture" onchange="applyPracticeFilter()" />
                Architecture
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Community Engagement" onchange="applyPracticeFilter()" />
                Community Engagement
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Computing" onchange="applyPracticeFilter()" />
                Computing
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Design" onchange="applyPracticeFilter()" />
                Design
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Fashion" onchange="applyPracticeFilter()" />
                Fashion
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Film" onchange="applyPracticeFilter()" />
                Film
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Fine Art" onchange="applyPracticeFilter()" />
                Fine Art
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Image" onchange="applyPracticeFilter()" />
                Image
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Music" onchange="applyPracticeFilter()" />
                Music
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Performance Arts" onchange="applyPracticeFilter()" />
                Performance Arts
            </div>
            <div class="filter-checkbox">
                <input type="checkbox" id="Publication" onchange="applyPracticeFilter()" />
                Publication
            </div>
        </div>
        <button onclick="clearFilters()">Clear Filters</button>
    </div>



    <div id="popup-container">
        <div class="popup">

            <button onclick="closePopup()" class="icon-button" style="margin-top: 0px;">
                <img src="community.svg" alt="Community Icon" class="button-icon">
                VIEW COMMUNITY
            </button><br />

            <img id="popup-image" src="" alt="Profile Image" />
            <h2 id="popup-title"></h2>
            

            <!-- Social Icons -->
            <div class="social-icons">
                <img src="ig.svg" alt="Instagram" class="social-icon" />
                <img src="ig.svg" alt="YouTube" class="social-icon" />
                <img src="ig.svg" alt="TikTok" class="social-icon" />
            </div>
            <!-- User desc. -->
            <p id="popup-description"></p>

            <!-- (S) Redirected Link Section -->
            <div class="redirect-link">
                <img src="placeholder.jpg" alt="Link Image" class="link-image" />
                <div class="link-text">
                    <p class="link-title">Link Title</p>
                    <p class="link-description">Short description of the link.</p>
                </div>
                <span class="share-icon">...</span>
            </div>

            <!-- (S) Redirected Link Section -->
            <div class="redirect-link">
                <img src="placeholder.jpg" alt="Link Image" class="link-image" />
                <div class="link-text">
                    <p class="link-title">Link Title</p>
                    <p class="link-description">Short description of the link.</p>
                </div>
                <span class="share-icon">...</span>
            </div>

            <!-- (L) Redirected Link Section -->
            <div class="redirect-link-L">
                <img src="placeholder.jpg" alt="Link Image" class="link-image-L" />
                <div class="link-content-L">
                    <div class="link-text-L">
                        <p class="link-title-L">Link Title</p>
                        <p class="link-description-L">Short description of the link.</p>
                    </div>
                    <span class="share-icon-L">...</span>
                </div>
            </div>

            <!-- (S) Redirected Link Section -->
            <div class="redirect-link">
                <img src="placeholder.jpg" alt="Link Image" class="link-image" />
                <div class="link-text">
                    <p class="link-title">Link Title</p>
                    <p class="link-description">Short description of the link.</p>
                </div>
                <span class="share-icon">...</span>
            </div>

            <!-- ( ) SPACER -->
            <div class="popup-spacer">
                <div class="popup-spacer-line"></div>
            </div>

            <!-- ( ) FEATURED SCROLLCHANNEL -->
            <div class="redirect-link-featurescroll">
                <h3>FEATURED:</h3>

                <div class="feature-tile-container">

                    <div class="feature-tile">
                        <img src="placeholder.jpg" alt="Link Image" class="link-image-L" />
                        <div class="link-content-L">
                            <div class="link-text-L">
                                <p class="link-title-L">Link Title</p>
                                <p class="link-description-L">Short description of the link.</p>
                            </div>
                            <span class="share-icon-L">...</span>
                        </div>
                    </div>
                    <div class="feature-tile">
                        <img src="placeholder.jpg" alt="Link Image" class="link-image-L" />
                        <div class="link-content-L">
                            <div class="link-text-L">
                                <p class="link-title-L">Link Title</p>
                                <p class="link-description-L">Short description of the link.</p>
                            </div>
                            <span class="share-icon-L">...</span>
                        </div>
                    </div>
                    <div class="feature-tile">
                        <img src="placeholder.jpg" alt="Link Image" class="link-image-L" />
                        <div class="link-content-L">
                            <div class="link-text-L">
                                <p class="link-title-L">Link Title</p>
                                <p class="link-description-L">Short description of the link.</p>
                            </div>
                            <span class="share-icon-L">...</span>
                        </div>
                    </div>
                    <div class="feature-tile">
                        <img src="placeholder.jpg" alt="Link Image" class="link-image-L" />
                        <div class="link-content-L">
                            <div class="link-text-L">
                                <p class="link-title-L">Link Title</p>
                                <p class="link-description-L">Short description of the link.</p>
                            </div>
                            <span class="share-icon-L">...</span>
                        </div>
                    </div>

                </div>


            </div>


            <!-- ( ) SPACER -->
            <div class="popup-spacer">
                <div class="popup-spacer-line"></div>
            </div>

            <!-- (S) Redirected Link Section -->
            <div class="redirect-link">
                <img src="placeholder.jpg" alt="Link Image" class="link-image" />
                <div class="link-text">
                    <p class="link-title">Link Title</p>
                    <p class="link-description">Short description of the link.</p>
                </div>
                <span class="share-icon">...</span>
            </div>

            <button onclick="closePopup()" class="icon-button altButton" style="margin-top: 0px;">
                <img src="KRICON.png" alt="Community Icon" class="button-icon">
                JOIN USER ON KR
            </button><br />


        </div>
    </div>




    <div class="tooltip-legend">
        <strong>Legend:</strong>
        <ul>
            <li>
                <span style="color: #69b3a2">Default Node Color</span>: Active nodes
            </li>
            <li>
                <span style="color: #ffa500">Highlighted Node</span>:
                Selected/Filtered nodes
            </li>
        </ul>
    </div>

    <svg></svg>

    <script>
        const profiles = {
            Alice: {
                title: "Alice",
                img: "https://via.placeholder.com/150",
                description: "Alice is a community leader.",
                connections: ["Bob", "Charlie", "Daisy"],
                practice: ["3D", "Sound", "Film"],
            },
            Bob: {
                title: "Bob",
                img: "avatar.png",
                description: "Bob loves gardening and outdoor activities.",
                connections: ["Alice", "Charlie", "David"],
                practice: ["3D", "Music", "Film"],
            },
            Charlie: {
                title: "Charlie",
                img: "https://via.placeholder.com/150",
                description: "Charlie is a tech enthusiast and developer.",
                connections: ["Quinn","Alice", "Bob", "Grace", "Eve", "George"],
                practice: ["3D", "Sound", "Fine Art"],
            },
            Daisy: {
                title: "Daisy",
                img: "https://via.placeholder.com/150",
                description: "Daisy is a creative artist.",
                connections: ["Alice", "Eve", "George"],
                practice: ["Publication", "Image", "Fine Art"],
            },
            Eva: {
                title: "Eva",
                img: "https://via.placeholder.com/150",
                description: "Eva is passionate about fashion and design.",
                connections: ["Charlie", "Daisy", "George"],
                practice: ["Fashion", "Design"],
            },
            George: {
                title: "George",
                img: "https://www.1-earth.world/KANGRECORDS/img/worldwidecover.jpg",
                description: "George is a film director and actor.",
                connections: ["Charlie", "Daisy", "Eva", "Lily"],
                practice: ["Film", "Performance Arts"],
            },
            Fiona: {
                title: "Fiona",
                img: "https://via.placeholder.com/150",
                description: "Fiona is an expert in architecture and 3D modeling.",
                connections: ["Alice", "Eva", "Michael"],
                practice: ["Architecture", "3D"],
            },
            Henry: {
                title: "Henry",
                img: "https://via.placeholder.com/150",
                description:
                    "Henry is a publication designer with a love for visual arts.",
                connections: ["David", "Charlie", "Rachel", "Jack"],
                practice: ["Publication", "Design"],
            },
            Isabella: {
                title: "Isabella",
                img: "https://via.placeholder.com/150",
                description: "Isabella is a music producer and composer.",
                connections: ["Bob", "George", "Lily"],
                practice: ["Music", "Performance Arts"],
            },
            Jack: {
                title: "Jack",
                img: "https://via.placeholder.com/150",
                description: "Jack is a fine art painter and sculptor.",
                connections: ["David", "Eva", "Steven", "Henry"],
                practice: ["Fine Art", "Image"],
            },
            Kevin: {
                title: "Kevin",
                img: "https://via.placeholder.com/150",
                description: "Kevin is a computing expert and digital artist.",
                connections: ["Grace", "Fiona", "Peter"],
                practice: ["Computing", "Design"],
            },
            Lily: {
                title: "Lily",
                img: "https://via.placeholder.com/150",
                description: "Lily is a passionate dancer and performer.",
                connections: ["George", "Isabella", "Quinn"],
                practice: ["Performance Arts", "Music"],
            },
            Michael: {
                title: "Michael",
                img: "https://via.placeholder.com/150",
                description: "Michael is an expert in architecture and urban design.",
                connections: ["Fiona", "Daisy"],
                practice: ["Architecture", "Design"],
            },
            Noah: {
                title: "Noah",
                img: "https://via.placeholder.com/150",
                description:
                    "Noah is a film producer with an interest in music video production.",
                connections: ["Quinn","Bob", "Isabella", "Quinn"],
                practice: ["Film", "Music"],
            },
            Olivia: {
                title: "Olivia",
                img: "https://via.placeholder.com/150",
                description: "Olivia is a fine art curator and gallerist.",
                connections: ["Charlie", "Jack"],
                practice: ["Fine Art", "Publication"],
            },
            Peter: {
                title: "Peter",
                img: "https://via.placeholder.com/150",
                description:
                    "Peter is a computing researcher focused on AI and graphics.",
                connections: ["Grace", "Michael", "Kevin"],
                practice: ["Computing", "3D"],
            },
            Quinn: {
                title: "Quinn",
                img: "https://via.placeholder.com/150",
                description: "Quinn is a talented sound designer and music artist.",
                connections: ["Noah","Charlie","Eva", "George", "Lily"],
                practice: ["Music", "Sound"],
            },
            Rachel: {
                title: "Rachel",
                img: "https://via.placeholder.com/150",
                description: "Rachel is a publication editor and content strategist.",
                connections: ["Henry", "Olivia"],
                practice: ["Publication", "Design"],
            },
            Steven: {
                title: "Steven",
                img: "https://via.placeholder.com/150",
                description: "Steven is an expert in digital fashion and textiles.",
                connections: ["Eva", "Jack"],
                practice: ["Fashion", "Fine Art"],
            },
        };

        const nodes = Object.keys(profiles).map((id) => ({
            id,
            ...profiles[id],
        }));
        const links = [];
        Object.entries(profiles).forEach(([id, profile]) => {
            profile.connections.forEach((connection) => {
                if (profiles[connection]?.connections.includes(id)) {
                    links.push({ source: id, target: connection });
                }
            });
        });

        const width = window.innerWidth;
        const height = window.innerHeight - 20;

        const svg = d3
            .select("svg")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("preserveAspectRatio", "xMidYMid meet")
            .call(
                d3.zoom().on("zoom", (event) => {
                    svg.select("g").attr("transform", event.transform);
                })
            );

        const container = svg.append("g");

        const simulation = d3
            .forceSimulation(nodes)
            .force(
                "link",
                d3
                    .forceLink()
                    .id((d) => d.id)
                    .distance(100)
            )
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(20))
            .alphaDecay(0.03);

        const link = container
            .append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter()
            .append("line")
            .attr("class", "link");

        const node = container
            .append("g")
            .attr("class", "nodes")
            .selectAll("g")
            .data(nodes)
            .enter()
            .append("g");

        node
            .append("circle")
            .attr("r", 10)
            .attr("fill", "#69b3a2")
            .on("click", (event, d) => {  
                showPopup(d);
                highlightNodeAndConnections(d);
                recenterGraph(d);
            });

        node
            .append("text")
            .attr("x", 12)
            .attr("y", 4)
            .text((d) => d.title)
            .style("font-family", "'Helvetica Neue', Helvetica, Arial, sans-serif")
            .style("font-size", "12px")
            .style("fill", "white");

        simulation.nodes(nodes).on("tick", () => {
            link
                .attr("x1", (d) => d.source.x)
                .attr("y1", (d) => d.source.y)
                .attr("x2", (d) => d.target.x)
                .attr("y2", (d) => d.target.y);

            node.attr("transform", (d) => `translate(${d.x},${d.y})`);
        });

        simulation.force("link").links(links);

        function showPopup(nodeData) {
            document.getElementById("popup-title").textContent = nodeData.title;
            document.getElementById("popup-image").src = nodeData.img;
            document.getElementById("popup-description").textContent = nodeData.description;
            document.getElementById("popup-container").style.display = "flex";
        }

        function closePopup() {
            document.getElementById("popup-container").style.display = "none";
        }

        function highlightNodeAndConnections(selectedNode) {
            link
                .classed(
                    "dimmed",
                    (d) =>
                        !(
                            d.source.id === selectedNode.id ||
                            d.target.id === selectedNode.id
                        )
                )
                .classed(
                    "highlighted-link",
                    (d) =>
                        d.source.id === selectedNode.id || d.target.id === selectedNode.id
                );

            node
            
                .classed(
                    "dimmed",
                    
                    
                    (d) =>
                    
                        d.id !== selectedNode.id &&
                        !selectedNode.connections.includes(d.id)
                )
                .classed(
                    "highlighted-node",
                    (d) =>
                        d.id === selectedNode.id ||
                        selectedNode.connections.includes(d.id)
                );
        }

        function recenterGraph(filteredNodes) {
            if (!filteredNodes || !filteredNodes.length) return;
            const centerX = d3.mean(filteredNodes, (n) => n.x || 0);
            const centerY = d3.mean(filteredNodes, (n) => n.y || 0);
            const transform = d3.zoomIdentity.translate(
                width / 2 - centerX,
                height / 2 - centerY
            );
            container.transition().duration(750).attr("transform", transform);
            svg.transition().duration(750).call(d3.zoom().transform, transform);
        }

        function recenterGraph(selectedNode) {
            const transform = d3.zoomIdentity.translate(
                width / 2 - selectedNode.x,
                height / 2 - selectedNode.y
            );

            container.transition().duration(750).attr('transform', transform);

            svg.transition().duration(750).call(
                d3.zoom().transform,
                transform
            );
        }

        function searchNode() {
            const query = document
                .getElementById("search-input")
                .value.toLowerCase();
            const matchedNode = nodes.find((node) =>
                node.id.toLowerCase().includes(query)
            );
            if (matchedNode) {
                highlightNodeAndConnections(matchedNode);
                recenterGraph([matchedNode]);
            } else {
                alert("Node not found!");
            }
        }

        function clearFilters() {
            // Uncheck all checkboxes
            document
                .querySelectorAll(".filter-checkbox input")
                .forEach((input) => (input.checked = false));
            // Remove all highlights and dimmed nodes
            node.classed("dimmed", false).classed("highlighted-node", false);
            link.classed("dimmed", false).classed("highlighted-link", false);
            recenterGraph(nodes);
        }

        function applyPracticeFilter() {
            // Get all selected practice filters
            const selectedPractices = Array.from(
                document.querySelectorAll(".filter-checkbox input:checked")
            ).map((input) => input.id);

            if (!selectedPractices.length) {
                clearFilters();
                return;
            }

            const filteredNodes = nodes.filter((node) =>
                selectedPractices.some((practice) => node.practice.includes(practice))
            );

            node
                .classed("dimmed", (d) => !filteredNodes.includes(d))
                .classed("highlighted-node", (d) => filteredNodes.includes(d));

            link
                .classed(
                    "dimmed",
                    (d) =>
                        !(
                            filteredNodes.includes(d.source) &&
                            filteredNodes.includes(d.target)
                        )
                )
                .classed(
                    "highlighted-link",
                    (d) =>
                        filteredNodes.includes(d.source) &&
                        filteredNodes.includes(d.target)
                );

            recenterGraph(filteredNodes);
        }

        function toggleFilterMenu() {
            const menu = document.getElementById("filter-menu");
            const filterButton = document.getElementById("filter-button");
            if (menu.style.display === "block") {
                menu.style.display = "none";
                filterButton.textContent = "Filter by Practice";
            } else {
                menu.style.display = "block";
                filterButton.textContent = "Close Filter";
            }
        }

        // Close dropdown when clicking outside of it
        document.addEventListener("click", function (event) {
            const filterMenu = document.getElementById("filter-menu");
            const filterButton = document.getElementById("filter-button");
            if (
                !filterButton.contains(event.target) &&
                !filterMenu.contains(event.target)
            ) {
                filterMenu.style.display = "none";
                filterButton.textContent = "Filter by Practice";
            }
        });
    </script>
</body>

</html>